#Kod

Kod nie jest d³ugi, ani zbyt skomplikowany. Piny zostaj¹ zdefiniowane na pocz¹tku, a ich tryby w funkcji “setup”. W instrukcji “loop” wartoœæ prêdkoœci obrotowej silnika jest odczytywana z wejœcia analogowego, a nastêpnie dzielona przez 4. Dzieje siê tak dlatego, ¿e odczyt bêdzie siê zawieraæ pomiêdzy 0 a 1023, a na wyjœciu analogowym potrzebujemy zakresu od 0 do 255.

<figure>
<a href="2.jpg" target="_blank"><img src="2.jpg" class="img-responsive"></a>
<figcaption>Uk³ad L293 na p³ytce stykowej</figcaption>
</figure>

<pre>
<span style="color: #7E7E7E;">/*</span>
<span style="color: #7E7E7E;">Adafruit&nbsp;Arduino&nbsp;-&nbsp;Lesson&nbsp;15.&nbsp;Bi-directional&nbsp;Motor</span>
<span style="color: #7E7E7E;">*/</span>

<span style="color: #CC6600;">int</span> enablePin = 11;
<span style="color: #CC6600;">int</span> in1Pin = 10;
<span style="color: #CC6600;">int</span> in2Pin = 9;
<span style="color: #CC6600;">int</span> switchPin = 7;
<span style="color: #CC6600;">int</span> potPin = 0;

<span style="color: #CC6600;">void</span> <span style="color: #CC6600;"><b>setup</b></span>()
{
&nbsp;&nbsp;<span style="color: #CC6600;">pinMode</span>(in1Pin, <span style="color: #006699;">OUTPUT</span>);
&nbsp;&nbsp;<span style="color: #CC6600;">pinMode</span>(in2Pin, <span style="color: #006699;">OUTPUT</span>);
&nbsp;&nbsp;<span style="color: #CC6600;">pinMode</span>(enablePin, <span style="color: #006699;">OUTPUT</span>);
&nbsp;&nbsp;<span style="color: #CC6600;">pinMode</span>(switchPin, <span style="color: #006699;">INPUT_PULLUP</span>);
}

<span style="color: #CC6600;">void</span> <span style="color: #CC6600;"><b>loop</b></span>()
{
&nbsp;&nbsp;<span style="color: #CC6600;">int</span> <span style="color: #CC6600;">speed</span> = <span style="color: #CC6600;">analogRead</span>(potPin) / 4;
&nbsp;&nbsp;<span style="color: #CC6600;">boolean</span> reverse = <span style="color: #CC6600;">digitalRead</span>(switchPin);
&nbsp;&nbsp;setMotor(<span style="color: #CC6600;">speed</span>, reverse);
}

<span style="color: #CC6600;">void</span> setMotor(<span style="color: #CC6600;">int</span> <span style="color: #CC6600;">speed</span>, <span style="color: #CC6600;">boolean</span> reverse)
{
&nbsp;&nbsp;<span style="color: #CC6600;">analogWrite</span>(enablePin, <span style="color: #CC6600;">speed</span>);
&nbsp;&nbsp;<span style="color: #CC6600;">digitalWrite</span>(in1Pin, ! reverse);
&nbsp;&nbsp;<span style="color: #CC6600;">digitalWrite</span>(in2Pin, reverse);
}

</pre>

W przypadku naciœniêcia przycisku, silnik bêdzie siê krêci³ zgodnie ze wskazówkami zegara, inaczej bêdzie siê krêci³ przeciwnie. Wartoœæ zmiennej “reverse” jest przypisana do wartoœci odczytanej z pinu przycisku. W zwi¹zku z tym, jeœli przycisk jest wciœniêty, to wartoœæ bêdzie “False”, w innym przypadku “True”.
Odczytane wartoœci s¹ przekazywane nastêpnie do funkcji “setMotor”, która ustawi odpowiednie piny w uk³adzie L293D kontroluj¹cym silnik.

<pre>
<span style="color: #CC6600;">void</span> setMotor(<span style="color: #CC6600;">int</span> <span style="color: #CC6600;">speed</span>, <span style="color: #CC6600;">boolean</span> reverse)
{
&nbsp;&nbsp;<span style="color: #CC6600;">analogWrite</span>(enablePin, <span style="color: #CC6600;">speed</span>);
&nbsp;&nbsp;<span style="color: #CC6600;">digitalWrite</span>(in1Pin, ! reverse);
&nbsp;&nbsp;<span style="color: #CC6600;">digitalWrite</span>(in2Pin, reverse);
}

</pre>

Prêdkoœæ obrotow¹ ustawiamy u¿ywaj¹c “analogWrite” na pinie “enable” (pin nr.1 L293D). Pin ten ma za zadanie w³¹czaæ i wy³¹czaæ silnik w zale¿noœci od stanów wejœæ in1 oraz in2. W celu kontroli kierunku obrotów, piny in1 oraz in2 musz¹ mieæ przeciwne wartoœci. Jeœli in1 ma stan wysoki (H) a in2 niski (L), to silnik bêdzie siê krêciæ w jednym kierunku. W przypadku przeciwnych wartoœci na in1 oraz in2 silnik bêdzie siê krêciæ w przeciwnym kierunku.
Komenda “!” oznacza “nie” lub w ang. “not”. Funkcja “DigitalWrite” dla in1 jest zawsze przeciwna do wartoœci “reverse”, czyli jeœli “reverse” jest ustawione jako H to funkcja ustawia L i odwrotnie. Druga funkcja “DigitalWrite” dla in2 ustawia pin dla takiej wartoœci jak¹ ma “reverse”. Oznacza to, ¿e wartoœæ ta bêdzie zawsze przeciwna do wartoœci in1.
